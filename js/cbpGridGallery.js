!function(t){"use strict";var e=t.document.documentElement,s={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",msTransition:"MSTransitionEnd",transition:"transitionend"}[Modernizr.prefixed("transition")],i={transitions:Modernizr.csstransitions,support3d:Modernizr.csstransforms3d};function n(t,e){t.style.WebkitTransform=e,t.style.msTransform=e,t.style.transform=e}function r(){var s=e.clientWidth,i=t.innerWidth;return s<i?i:s}function o(t,e){for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);return t}function l(t,e){this.el=t,this.options=o({},this.options),o(this.options,e),this._init()}l.prototype.options={},l.prototype._init=function(){this.grid=this.el.querySelector(".grid-wrap > ul.gridlist"),this.gridItems=[].slice.call(this.grid.querySelectorAll("li:not(.grid-sizer)")),this.itemsCount=this.gridItems.length,this.slideshow=this.el.querySelector(".slideshow > ul"),this.slideshowItems=[].slice.call(this.slideshow.children),this.current=-1,this.ctrlPrev=this.el.querySelector(".slideshow > nav > span.nav-prev"),this.ctrlNext=this.el.querySelector(".slideshow > nav > span.nav-next"),this.ctrlClose=this.el.querySelector(".slideshow > nav > span.nav-close"),this._initMasonry(),this._initEvents()},l.prototype._initMasonry=function(){var t=this.grid;imagesLoaded(t,function(){new Masonry(t,{itemSelector:"li",columnWidth:t.querySelector(".grid-sizer")})})},l.prototype._initEvents=function(){var s=this;this.gridItems.forEach(function(t,e){t.addEventListener("click",function(){s._openSlideshow(e)})}),this.ctrlPrev.addEventListener("click",function(){s._navigate("prev")}),this.ctrlNext.addEventListener("click",function(){s._navigate("next")}),this.ctrlClose.addEventListener("click",function(){s._closeSlideshow()}),t.addEventListener("resize",function(){s._resizeHandler()}),document.addEventListener("keydown",function(t){if(s.isSlideshowVisible){var e=t.keyCode||t.which;switch(e){case 37:s._navigate("prev");break;case 39:s._navigate("next");break;case 27:s._closeSlideshow()}}}),t.addEventListener("scroll",function(){s.isSlideshowVisible?t.scrollTo(s.scrollPosition?s.scrollPosition.x:0,s.scrollPosition?s.scrollPosition.y:0):s.scrollPosition={x:t.pageXOffset||e.scrollLeft,y:t.pageYOffset||e.scrollTop}})},l.prototype._openSlideshow=function(t){if(this.isSlideshowVisible=!0,this.current=t,classie.addClass(this.el,"slideshow-open"),this._setViewportItems(),classie.addClass(this.currentItem,"current"),classie.addClass(this.currentItem,"show"),this.prevItem){classie.addClass(this.prevItem,"show");var e=Number(-1*(r()/2+this.prevItem.offsetWidth/2));n(this.prevItem,i.support3d?"translate3d("+e+"px, 0, -150px)":"translate("+e+"px)")}if(this.nextItem){classie.addClass(this.nextItem,"show");var e=Number(r()/2+this.nextItem.offsetWidth/2);n(this.nextItem,i.support3d?"translate3d("+e+"px, 0, -150px)":"translate("+e+"px)")}this._toggleNavButtons()},l.prototype._navigate=function(t){if(!this.isAnimating){if("next"===t&&this.current===this.itemsCount-1||"prev"===t&&0===this.current){this._closeSlideshow();return}this.isAnimating=!0,this._setViewportItems();var e,o,l,a=this,h=this.currentItem.offsetWidth,c=i.support3d?"translate3d(-"+Number(r()/2+h/2)+"px, 0, -150px)":"translate(-"+Number(r()/2+h/2)+"px)",p=i.support3d?"translate3d("+Number(r()/2+h/2)+"px, 0, -150px)":"translate("+Number(r()/2+h/2)+"px)";"next"===t?(e=i.support3d?"translate3d( -"+Number(2*r()/2+h/2)+"px, 0, -150px )":"translate(-"+Number(2*r()/2+h/2)+"px)",o=i.support3d?"translate3d( "+Number(2*r()/2+h/2)+"px, 0, -150px )":"translate("+Number(2*r()/2+h/2)+"px)"):(e=i.support3d?"translate3d( "+Number(2*r()/2+h/2)+"px, 0, -150px )":"translate("+Number(2*r()/2+h/2)+"px)",o=i.support3d?"translate3d( -"+Number(2*r()/2+h/2)+"px, 0, -150px )":"translate(-"+Number(2*r()/2+h/2)+"px)"),classie.removeClass(a.slideshow,"animatable"),("next"===t&&this.current<this.itemsCount-2||"prev"===t&&this.current>1)&&(n(l=this.slideshowItems["next"===t?this.current+2:this.current-2],o),classie.addClass(l,"show")),setTimeout(function(){classie.addClass(a.slideshow,"animatable"),classie.removeClass(a.currentItem,"current");var r="next"===t?a.nextItem:a.prevItem;classie.addClass(r,"current"),n(a.currentItem,"next"===t?c:p),a.nextItem&&n(a.nextItem,"next"===t?"":e),a.prevItem&&n(a.prevItem,"next"===t?e:""),l&&n(l,"next"===t?p:c);var o=function(e){if(i.transitions){if(-1===e.propertyName.indexOf("transform"))return!1;this.removeEventListener(s,o)}a.prevItem&&"next"===t?classie.removeClass(a.prevItem,"show"):a.nextItem&&"prev"===t&&classie.removeClass(a.nextItem,"show"),"next"===t?(a.prevItem=a.currentItem,a.currentItem=a.nextItem,l&&(a.nextItem=l)):(a.nextItem=a.currentItem,a.currentItem=a.prevItem,l&&(a.prevItem=l)),a.current="next"===t?a.current+1:a.current-1,a.isAnimating=!1,a._toggleNavButtons()};i.transitions?a.currentItem.addEventListener(s,o):o()},25)}},l.prototype._closeSlideshow=function(t){classie.removeClass(this.el,"slideshow-open"),classie.removeClass(this.slideshow,"animatable");var e=this,r=function(t){if(i.transitions){if("ul"!==t.target.tagName.toLowerCase())return;this.removeEventListener(s,r)}classie.removeClass(e.currentItem,"current"),classie.removeClass(e.currentItem,"show"),e.prevItem&&classie.removeClass(e.prevItem,"show"),e.nextItem&&classie.removeClass(e.nextItem,"show"),e.slideshowItems.forEach(function(t){n(t,"")}),e.isSlideshowVisible=!1,e._toggleNavButtons()};i.transitions?this.el.addEventListener(s,r):r()},l.prototype._toggleNavButtons=function(){0===this.current?this.ctrlPrev.style.display="none":this.ctrlPrev.style.display="block",this.current===this.itemsCount-1?this.ctrlNext.style.display="none":this.ctrlNext.style.display="block"},l.prototype._setViewportItems=function(){this.currentItem=null,this.prevItem=null,this.nextItem=null,this.current>0&&(this.prevItem=this.slideshowItems[this.current-1]),this.current<this.itemsCount-1&&(this.nextItem=this.slideshowItems[this.current+1]),this.currentItem=this.slideshowItems[this.current]},l.prototype._resizeHandler=function(){var t=this;this._resizeTimeout&&clearTimeout(this._resizeTimeout),this._resizeTimeout=setTimeout(function e(){t._resize(),t._resizeTimeout=null},50)},l.prototype._resize=function(){if(this.isSlideshowVisible){if(this.prevItem){var t=Number(-1*(r()/2+this.prevItem.offsetWidth/2));n(this.prevItem,i.support3d?"translate3d("+t+"px, 0, -150px)":"translate("+t+"px)")}if(this.nextItem){var t=Number(r()/2+this.nextItem.offsetWidth/2);n(this.nextItem,i.support3d?"translate3d("+t+"px, 0, -150px)":"translate("+t+"px)")}}},t.CBPGridGallery=l}(window);